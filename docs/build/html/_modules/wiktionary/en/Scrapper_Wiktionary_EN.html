

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>wiktionary.en.Scrapper_Wiktionary_EN &mdash; Scrapper 3.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Scrapper 3.0.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Scrapper
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Docstring</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docstring/modules.html">Scrapper</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Scrapper</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>wiktionary.en.Scrapper_Wiktionary_EN</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for wiktionary.en.Scrapper_Wiktionary_EN</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">Scrapper_Helpers</span> <span class="k">import</span> <span class="n">convert_to_alnum</span><span class="p">,</span> <span class="n">deduplicate</span><span class="p">,</span> <span class="n">proper</span><span class="p">,</span> <span class="n">get_lognest_word</span>
<span class="kn">from</span> <span class="nn">wiktionary</span> <span class="k">import</span> <span class="n">Scrapper_Wiktionary</span>
<span class="kn">from</span> <span class="nn">wiktionary</span> <span class="k">import</span> <span class="n">Scrapper_Wiktionary_RemoteAPI</span>
<span class="kn">from</span> <span class="nn">wiktionary</span> <span class="k">import</span> <span class="n">Scrapper_Wiktionary_WikitextParser</span>
<span class="kn">from</span> <span class="nn">wiktionary.Scrapper_Wiktionary_Item</span> <span class="k">import</span> <span class="n">WikictionaryItem</span>
<span class="kn">from</span> <span class="nn">wiktionary.Scrapper_Wiktionary_Checkers</span> <span class="k">import</span> <span class="n">check_node</span>
<span class="kn">from</span> <span class="nn">wiktionary.Scrapper_Wiktionary_WikitextParser</span> <span class="k">import</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Template</span><span class="p">,</span> <span class="n">Li</span><span class="p">,</span> <span class="n">Dl</span><span class="p">,</span> <span class="n">Link</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">wiktionary.en.Scrapper_Wiktionary_EN_Sections</span> <span class="k">import</span> <span class="n">LANG_SECTIONS_INDEX</span><span class="p">,</span> <span class="n">PART_OF_SPEECH_SECTIONS_INDEX</span><span class="p">,</span> <span class="n">VALUED_SECTIONS_INDEX</span><span class="p">,</span> <span class="n">VALUED_SECTIONS</span>
<span class="kn">from</span> <span class="nn">wiktionary.en.Scrapper_Wiktionary_EN_TableOfContents</span> <span class="k">import</span> \
    <span class="n">Section</span><span class="p">,</span> <span class="n">Root</span><span class="p">,</span> <span class="n">Lang</span><span class="p">,</span> <span class="n">PartOfSpeech</span><span class="p">,</span> <span class="n">ExplanationsRoot</span><span class="p">,</span> <span class="n">section_map</span><span class="p">,</span> <span class="n">Explanation</span><span class="p">,</span> <span class="n">ExplanationExample</span><span class="p">,</span> <span class="n">Translations</span><span class="p">,</span> \
    <span class="n">ExplanationLi</span><span class="p">,</span> <span class="n">Synonyms</span>


<div class="viewcode-block" id="make_table_of_contents"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.make_table_of_contents">[docs]</a><span class="k">def</span> <span class="nf">make_table_of_contents</span><span class="p">(</span> <span class="n">lexemes</span><span class="p">:</span> <span class="nb">list</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Root</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create Table of contents for given `lexemes`.</span>

<span class="sd">    it search &lt;Header&gt; tokens. In raw-text it &#39;=English=&#39;, &#39;===Noun===&#39;. Then detect level of header. Then build tree.</span>

<span class="sd">    Args:</span>
<span class="sd">        lexemes (list):     List of lexemes. Lexemes going from raw-text parser (module Scrapper_Wiktionary_WikitextParser)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Root)  Tree root.</span>

<span class="sd">    ::</span>

<span class="sd">        # for &#39;cat&#39;</span>
<span class="sd">        toc = make_table_of_contents( lexems )</span>

<span class="sd">        # result is:</span>
<span class="sd">        toc.dump()</span>

<span class="sd">        # result:</span>
<span class="sd">          1. English</span>
<span class="sd">            1.1. Pronunciation</span>
<span class="sd">            1.2. Etymology 1</span>
<span class="sd">              1.2.1. Noun</span>
<span class="sd">                1.2.1.1. Synonyms</span>
<span class="sd">                1.2.1.2. Hyponyms</span>
<span class="sd">                1.2.1.3. Derived terms</span>
<span class="sd">                1.2.1.4. Translations</span>
<span class="sd">                1.2.1.ex. Explanations</span>
<span class="sd">                  1.2.1.ex.1. # An animal of the family [[Felidae]]:</span>
<span class="sd">                    1.2.1.ex.1.1. #* {{quote-book|en|year=2011|author=Karl Kruszelnicki|title=Brain Food|isbn=1466828129|page=53|passage=Mammals need two genes to make the taste receptor for sugar. Studies in various &#39;&#39;&#39;cats&#39;&#39;&#39; (tigers, cheetahs and domestic cats) showed that one of these genes has mutated and no longer works.}}</span>
<span class="sd">                    1.2.1.ex.1.:1. #: {{syn|en|felid}}</span>
<span class="sd">                    1.2.1.ex.1.2. ## A domesticated [[subspecies]] (&#39;&#39;[[Felis silvestris catus]]&#39;&#39;) of [[feline]] animal, commonly kept as a house [[pet]]. {{defdate|from 8&lt;sup&gt;th&lt;/sup&gt;c.}}</span>
<span class="sd">                      1.2.1.ex.1.2.1. ##* {{RQ:WBsnt IvryGt|II}}</span>
<span class="sd">                        1.2.1.ex.1.2.1.:1. ##*: At twilight in the summer there is never anybody to fear—man, woman, or &#39;&#39;&#39;cat&#39;&#39;&#39;—in the chambers and at that hour the mice come out. They do not eat parchment or foolscap or red tape, but they eat the luncheon crumbs.</span>
<span class="sd">                      1.2.1.ex.1.2.:1. ##: {{syn|en|puss|pussy|malkin|kitty|pussy-cat|grimalkin|Thesaurus:cat}}</span>
<span class="sd">                    1.2.1.ex.1.3. ## Any similar animal of the family [[Felidae]], which includes [[lion]]s, [[tiger]]s, bobcats, etc.</span>
<span class="sd">                      1.2.1.ex.1.3.1. ##* {{quote-book|en|year=1977|author=Peter Hathaway Capstick|title=Death in the Long Grass: A Big Game Hunter&#39;s Adventures in the African Bush|publisher=St. Martin&#39;s Press|page=44|passage=I grabbed it and ran over to the lion from behind, the &#39;&#39;&#39;cat&#39;&#39;&#39; still chewing thoughtfully on Silent&#39;s arm.}}</span>
<span class="sd">                      1.2.1.ex.1.3.2. ##* &#39;&#39;&#39;1985&#39;&#39;&#39; January, George Laycock, &quot;Our American Lion&quot;, in Boy Scouts of America, &#39;&#39;Boy&#39;s Life&#39;&#39;, 28.</span>
<span class="sd">                        1.2.1.ex.1.3.2.:1. ##*: If you should someday round a corner on the hiking trail and come face to face with a mountain lion, you would probably never forget the mighty &#39;&#39;&#39;cat&#39;&#39;&#39;.</span>
<span class="sd">                      1.2.1.ex.1.3.3. ##* {{quote-book|en|year=2014|author=Dale Mayer|title=Rare Find. A Psychic Visions Novel|publisher=Valley Publishing|passage=She felt privileged to be here, living the experience inside the majestic &#39;&#39;&#39;cat&#39;&#39;&#39; [i.e. a tiger]; privileged to be part of their bond, even for only a few hours.}}</span>
<span class="sd">                  1.2.1.ex.2. # A person:</span>
<span class="sd">                    1.2.1.ex.2.1. ## {{lb|en|offensive}} A spiteful or angry [[woman]]. {{defdate|from earlier 13&lt;sup&gt;th&lt;/sup&gt;c.}}</span>
<span class="sd">                      1.2.1.ex.2.1.1. ##* &#39;&#39;&#39;1835&#39;&#39;&#39; September, anonymous, &quot;The Pigs&quot;, in &#39;&#39;The New-England Magazine&#39;&#39;, Vol. 9, 156.</span>
<span class="sd">                        1.2.1.ex.2.1.1.:1. ##*: But, ere one rapid moon its tale has told, / He finds his prize — a &#39;&#39;&#39;cat&#39;&#39;&#39; — a slut — a scold.</span>
<span class="sd">                      1.2.1.ex.2.1.:1. ##: {{syn|en|bitch}}</span>
<span class="sd">                    1.2.1.ex.2.2. ## An enthusiast or player of [[jazz]].</span>
<span class="sd">                      1.2.1.ex.2.2.1. ##* {{quote-song|en|year=2008|author={{w|Nick Cave and the Bad Seeds}}|title=Hold on to Yourself|passage=I turn on the radio / There&#39;s some &#39;&#39;&#39;cat&#39;&#39;&#39; on the saxophone / Laying down a litany of excuses}}</span>
<span class="sd">                    1.2.1.ex.2.3. ## {{lb|en|slang}} A person (usually male).</span>
<span class="sd">                      1.2.1.ex.2.3.1. ##* {{quote-song|en|title=Starman|album=The Rise and Fall of Ziggy Stardust and the Spiders from Mars|artist=David Bowie|year=1972|passage=Didn&#39;t know what time it was the lights were low / I leaned back on my radio / Some &#39;&#39;&#39;cat&#39;&#39;&#39; was layin&#39; down some rock&#39;n&#39;roll &#39;lotta soul, he said}}</span>
<span class="sd">                      1.2.1.ex.2.3.2. ##* &#39;&#39;&#39;1973&#39;&#39;&#39; December, &quot;Books Noted&quot;, discussing &#39;&#39;A Dialogue&#39;&#39; (by James Baldwin and Nikki Giovanni), in &#39;&#39;Black World&#39;&#39;, Johnson Publishing Company, 77.</span>
<span class="sd">                        1.2.1.ex.2.3.2.:1. ##*: BALDWIN: That&#39;s what we were talking about before. And by the way, you did not have to tell me that you think your father is a groovy &#39;&#39;&#39;cat&#39;&#39;&#39;; I knew that.</span>
<span class="sd">                      1.2.1.ex.2.3.3. ##* {{quote-song|en|artist={{w|Shaquille O&#39;Neal}}|title=Fiend|year=1998|album=Respect|passage=What fags are true I know what Mack&#39;s might do&lt;br/&gt;I&#39;m quite familiar with &#39;&#39;&#39;cats&#39;&#39;&#39; like you&lt;br&gt;Provoke to get me give me a good reason to smoke me&lt;br&gt;Try to break me but never wrote me)}}</span>
<span class="sd">                      1.2.1.ex.2.3.4. ##* {{quote-song|en|year=2006|lyricist=Masta Ace|title=Sick of it all|album=Pariah|passage=I am sick of rappers claiming they hot when they really not&lt;br/&gt;I am sick of rappers bragging about shit they ain’t really got&lt;br/&gt;These &#39;&#39;&#39;cats&#39;&#39;&#39; stay rapping about cars they don’t own&lt;br/&gt;I am sick of rappers bragging about models they don’t bone.[…]&lt;br/&gt;And I am sick of all these &#39;&#39;&#39;cats&#39;&#39;&#39; with no talent&lt;br/&gt;That never lived in the hood but yet their lyrics be so violent.}}</span>
<span class="sd">                      1.2.1.ex.2.3.:1. ##: {{syn|en|bloke|chap|cove|dude|fellow|fella|guy}}</span>
<span class="sd">                    1.2.1.ex.2.4. ## {{lb|en|slang}} A [[prostitute]]. {{defdate|from at least early 15&lt;sup&gt;th&lt;/sup&gt;c.}}</span>
<span class="sd">                      1.2.1.ex.2.4.1. ##* {{quote-book|en|year=1999|author=Carl P. Eby|title=Hemingway&#39;s Fetishism. Psychoanalysis and the Mirror of Manhood|publisher=State University of New York Press|page=124|passage=&quot;Tell me. Willie said there was a &#39;&#39;&#39;cat&#39;&#39;&#39; in love with you. That isn&#39;t true, is it?&quot; &quot;Yes. It&#39;s true,&quot; Hudson corrects her, letting her think that by &quot;cat&quot; he means prostitute.}}</span>
<span class="sd">                  1.2.1.ex.3. # {{lb|en|nautical}} A strong tackle used to hoist an anchor to the [[cathead]] of a ship.</span>
<span class="sd">                    1.2.1.ex.3.1. #* {{quote-book|en|year=2009|author=Olof A. Eriksen|title=Constitution - All Sails Up and Flying|publisher=Outskirts Press|page=134|passage=Overhaul down &amp; hook the &#39;&#39;&#39;cat&#39;&#39;&#39;, haul taut. Walk away the &#39;&#39;&#39;cat&#39;&#39;&#39;. When up, pass the &#39;&#39;&#39;cat&#39;&#39;&#39; head stopper. Hook the fish in &amp; fish the anchor.}}</span>
<span class="sd">                  1.2.1.ex.4. # {{lb|en|chiefly|nautical}} {{non-gloss definition|Short form of}} [[cat-o&#39;-nine-tails]].</span>
<span class="sd">                    1.2.1.ex.4.1. #* {{quote-book|en|year=1839|section=testimony by {{w|Henry L. Pinckney}} (Assembly No. 335)|title=Documents of the Assembly of the State of New York|page=44|passage={{...}}he whipped a black man for disobedience of his orders fifty lashes; and again whipped him with a &#39;&#39;&#39;cat&#39;&#39;&#39;, which he wound with wire, about the same number of stripes;{{...}}he used this &#39;&#39;&#39;cat&#39;&#39;&#39; on one other man, and then destroyed the &#39;&#39;&#39;cat&#39;&#39;&#39; wound with wire.}}</span>
<span class="sd">                  1.2.1.ex.5. # {{lb|en|archaic}} A sturdy merchant sailing vessel {{qualifier|now only in &quot;[[catboat]]&quot;}}.</span>
<span class="sd">                  1.2.1.ex.6. # {{lb|en|archaic|uncountable}} The game of &quot;[[trap and ball]]&quot; (also called &quot;cat and dog&quot;).</span>
<span class="sd">                    1.2.1.ex.6.1. ## The trap of the game of &quot;trap and ball&quot;.</span>
<span class="sd">                  1.2.1.ex.7. # {{lb|en|archaic}} The pointed piece of wood that is struck in the game of [[tipcat]].</span>
<span class="sd">                  1.2.1.ex.8. # {{lb|en|slang|vulgar|African American Vernacular English}} A [[vagina]], a [[vulva]]; the female external genitalia.</span>
<span class="sd">                    1.2.1.ex.8.1. #* {{quote-book|en|year=1969|author=Iceberg Slim|title=Pimp: The Story of My Life|publisher=Holloway House Publishing|passage=&quot;What the hell, so this broad&#39;s got a prematurely-gray &#39;&#39;&#39;cat&#39;&#39;&#39;.&quot;}}</span>
<span class="sd">                    1.2.1.ex.8.2. #* {{quote-book|en|year=2005|author=Carolyn Chambers Sanders|title=Sins &amp; Secrets|publisher=Hachette Digital|passage=As she came up, she tried to put her &#39;&#39;&#39;cat&#39;&#39;&#39; in his face for some licking.}}</span>
<span class="sd">                    1.2.1.ex.8.3. #* {{quote-book|en|year=2007|author=Franklin White|title=Money for Good|publisher=Simon and Schuster|page=64|passage=I had a notion to walk over to her, rip her apron off, sling her housecoat open and put my finger inside her &#39;&#39;&#39;cat&#39;&#39;&#39; to see if she was wet or freshly fucked because the dream I had earlier was beginning to really annoy me.}}</span>
<span class="sd">                  1.2.1.ex.9. # A [[double]] [[tripod]] (for holding a [[plate]], etc.) with six feet, of which three rest on the ground, in whatever position it is placed.</span>
<span class="sd">                  1.2.1.ex.10. # {{lb|en|historical}} A [[wheel]]ed [[shelter]], used in the [[Middle Ages]] as a [[siege]] weapon to allow [[assailant]]s to approach enemy [[defence]]s.</span>
<span class="sd">                    1.2.1.ex.10.:1. #: {{syn|en|tortoise|Welsh cat}}</span>
<span class="sd">                    1.2.1.ex.10.1. #*{{quote-book|en|year=2000|author=Stephen O&#39;Shea|title=The Perfect Heresy|publisher=Profile Books|page=97|passage=From behind the narrow slits in the walls of Castellar, crossbowmen and archers took aim at the juddering &#39;&#39;&#39;cat&#39;&#39;&#39; as it came closer.}}</span>
<span class="sd">              1.2.2. Verb</span>
<span class="sd">                1.2.2.1. Translations</span>
<span class="sd">                1.2.2.ex. Explanations</span>
<span class="sd">                  1.2.2.ex.1. # {{lb|en|nautical|transitive}} To [[hoist]] (the [[anchor]]) by its [[ring]] so that it hangs at the [[cathead]].</span>
<span class="sd">                  1.2.2.ex.2. # {{lb|en|nautical|transitive}} To flog with a [[cat-o&#39;-nine-tails]].</span>
<span class="sd">                  1.2.2.ex.3. # {{lb|en|slang}} To [[vomit]] something.</span>
<span class="sd">                  1.2.2.ex.4. # To go [[wander]]ing at [[night]].</span>
<span class="sd">                    1.2.2.ex.4.1. #* {{quote-book|en |year=1998 |title=Lady&#39;s Wager |author=Mary Spencer |page=324|ISBN=|passage=&quot;He doesn&#39;t realize that I know,&quot; Lord Callan said, &quot;but it&#39;s been pretty obvious that most of his &#39;&#39;&#39;catting&#39;&#39;&#39; about London&#39;s darker alleys has been a search for his origins. }}</span>
<span class="sd">                    1.2.2.ex.4.2. #* {{quote-book|en |year=2010|title=Manchild in the Promised Land |author=Claude Brown |page=18|ISBN=|passage=This was going to be my first try at &#39;&#39;&#39;catting&#39;&#39;&#39; out. I went looking for somebody to &#39;&#39;&#39;cat&#39;&#39;&#39; with me.}}</span>
<span class="sd">                    1.2.2.ex.4.3. #* {{quote-book|en |year=2012|title=Wages of Sin|author=Valerie Hansen |page=|ISBN=|passage=My own dear wife could have tended to his needs if she hadn&#39;t been out &#39;&#39;&#39;catting&#39;&#39;&#39;.}}</span>
<span class="sd">                  1.2.2.ex.5. # To [[gossip]] in a [[catty]] manner.</span>
<span class="sd">                    1.2.2.ex.5.1. #* {{quote-book|en |year=1932 |title=Man Made Angry |author=Hugh Brooke |page=134|ISBN=|passage=Men from young to middleaged, with matt faces, vivacious and brightly dressed, &#39;&#39;&#39;catted&#39;&#39;&#39; together in gay groups.}}</span>
<span class="sd">                    1.2.2.ex.5.2. #* {{quote-book|en |year=1996|title=The Unlucky Seven|author=Alistair Boyle |page=|ISBN=|passage=They smiled, touched, rolled their eyes and raised their eyebrows, as they relived the audition and &#39;&#39;&#39;catted&#39;&#39;&#39; about some of their competition.}}</span>
<span class="sd">                    1.2.2.ex.5.3. #* {{quote-book|en |year=2016 |title=The Swans of Fifth Avenue|author=Melanie Benjamin |page=293|ISBN=|passage=In the story, Lady Ina gossiped and &#39;&#39;&#39;catted&#39;&#39;&#39; about a parade of the rich and famous—Jackie Kennedy looking like an exaggerated version of herself, Princess Margaret so boring she made people fall asleep, Gloria Vanderbilt so ditzy she didn&#39;t recognize her first husband.}}</span>
<span class="sd">              1.2.3. See also</span>
<span class="sd">            1.3. Etymology 2</span>
<span class="sd">              1.3.1. Noun</span>
<span class="sd">                1.3.1.ex. Explanations</span>
<span class="sd">                  1.3.1.ex.1. # A [[catamaran]].</span>
<span class="sd">            1.4. Etymology 3</span>
<span class="sd">              1.4.1. Noun</span>
<span class="sd">                1.4.1.ex. Explanations</span>
<span class="sd">                  1.4.1.ex.1. # {{lb|en|computing}} A program and command in [[Unix]] that reads one or more files and directs their content to the standard output.</span>
<span class="sd">              1.4.2. Verb</span>
<span class="sd">                1.4.2.ex. Explanations</span>
<span class="sd">                  1.4.2.ex.1. # {{lb|en|computing|transitive}} To [[apply]] the &#39;&#39;&#39;cat&#39;&#39;&#39; [[command]] to (one or more files).</span>
<span class="sd">                  1.4.2.ex.2. # {{lb|en|computing|slang}} To [[dump]] large amounts of data on (an unprepared target) usually with no intention of browsing it carefully.</span>
<span class="sd">            1.5. Etymology 4</span>
<span class="sd">              1.5.1. Adjective</span>
<span class="sd">                1.5.1.1. Usage notes</span>
<span class="sd">                1.5.1.ex. Explanations</span>
<span class="sd">                  1.5.1.ex.1. # {{lb|en|Ireland|informal}} [[terrible|Terrible]], [[disastrous]].</span>
<span class="sd">                    1.5.1.ex.1.:1. #: {{ux|en|The weather was &#39;&#39;&#39;cat&#39;&#39;&#39;, so they returned home early.}}</span>
<span class="sd">            1.6. Etymology 5</span>
<span class="sd">              1.6.1. Noun</span>
<span class="sd">                1.6.1.ex. Explanations</span>
<span class="sd">                  1.6.1.ex.1. # {{lb|en|slang}} {{non-gloss definition|A street name of the drug [[methcathinone]].}}</span>
<span class="sd">            1.7. Etymology 6</span>
<span class="sd">              1.7.1. Noun</span>
<span class="sd">                1.7.1.ex. Explanations</span>
<span class="sd">                  1.7.1.ex.1. # {{lb|en|military|naval}} A [[catapult]].</span>
<span class="sd">                    1.7.1.ex.1.:1. #: {{ux|en|a carrier&#39;s bow &#39;&#39;&#39;cats&#39;&#39;&#39;}}</span>
<span class="sd">            1.8. Etymology 7</span>
<span class="sd">              1.8.1. Noun</span>
<span class="sd">                1.8.1.ex. Explanations</span>
<span class="sd">                  1.8.1.ex.1. # {{abbreviation of|en|category}}</span>
<span class="sd">            1.9. Etymology 8</span>
<span class="sd">              1.9.1. Noun</span>
<span class="sd">                1.9.1.ex. Explanations</span>
<span class="sd">                  1.9.1.ex.1. # {{abbreviation of|en|catfish}}</span>
<span class="sd">                    1.9.1.ex.1.1. #* {{quote-book|en|year=1913|author={{w|Willa Cather}}|title=[[s:O Pioneers!|O Pioneers!]]|chapter=2|passage=She missed the fish diet of her own country, and twice every summer she sent the boys to the river, twenty miles to the southward, to fish for channel &#39;&#39;&#39;cat&#39;&#39;&#39;.}}</span>
<span class="sd">                    1.9.1.ex.1.2. #* &#39;&#39;&#39;1916&#39;&#39;&#39;, M. Shults, &quot;Fishing for Yellow Cat in the Brazos&quot;, in &#39;&#39;Field and Stream&#39;&#39;, vol. 21, 478.</span>
<span class="sd">                      1.9.1.ex.1.2.:1. #*: Fishing for &#39;&#39;&#39;cat&#39;&#39;&#39; is probably, up to a certain stage, the least exciting of all similar sports.</span>
<span class="sd">            1.10. Etymology 9</span>
<span class="sd">              1.10.1. Noun</span>
<span class="sd">                1.10.1.ex. Explanations</span>
<span class="sd">                  1.10.1.ex.1. # {{lb|en|slang}} Any of a variety of earth-moving [[machine]]s. (from their manufacturer {{w|Caterpillar Inc.}})</span>
<span class="sd">                  1.10.1.ex.2. # A [[caterpillar drive]] vehicle (a ground vehicle which uses [[caterpillar track]]s), especially tractors, trucks, minibuses, and snow groomers.</span>
<span class="sd">            1.11. References</span>
<span class="sd">            1.12. Anagrams</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Root</span><span class="p">()</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">root</span>

    <span class="c1"># 1. scan each lexem</span>
    <span class="c1"># 2. get Headers</span>
    <span class="c1"># 3. make tree</span>
    <span class="c1"># group lexems by class</span>
    <span class="k">for</span> <span class="n">lexem</span> <span class="ow">in</span> <span class="n">lexemes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">lexem</span><span class="p">,</span> <span class="n">Header</span> <span class="p">):</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">lexem</span>

            <span class="c1"># flags</span>
            <span class="n">beauty_name</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">beauty_name</span> <span class="ow">in</span> <span class="n">LANG_SECTIONS_INDEX</span><span class="p">:</span>
                <span class="c1"># Language</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">Lang</span><span class="p">()</span>
                <span class="n">node</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">name</span>
                <span class="n">node</span><span class="o">.</span><span class="n">title_norm</span> <span class="o">=</span> <span class="n">LANG_SECTIONS_INDEX</span><span class="p">[</span> <span class="n">beauty_name</span> <span class="p">]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">level</span>
                <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">header</span> <span class="p">)</span>

            <span class="k">elif</span> <span class="n">beauty_name</span> <span class="ow">in</span> <span class="n">PART_OF_SPEECH_SECTIONS_INDEX</span><span class="p">:</span>
                <span class="c1"># Part of speech</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">PartOfSpeech</span><span class="p">()</span>
                <span class="n">node</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">name</span>
                <span class="n">node</span><span class="o">.</span><span class="n">title_norm</span> <span class="o">=</span> <span class="n">PART_OF_SPEECH_SECTIONS_INDEX</span><span class="p">[</span> <span class="n">beauty_name</span> <span class="p">]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">level</span>
                <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">header</span> <span class="p">)</span>

            <span class="k">elif</span> <span class="n">beauty_name</span> <span class="ow">in</span> <span class="n">VALUED_SECTIONS_INDEX</span><span class="p">:</span>
                <span class="c1"># Synonyms, Antonyms, Translations</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">section_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">beauty_name</span><span class="p">,</span> <span class="n">Section</span> <span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
                <span class="n">node</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">name</span>
                <span class="n">node</span><span class="o">.</span><span class="n">title_norm</span> <span class="o">=</span> <span class="n">VALUED_SECTIONS_INDEX</span><span class="p">[</span> <span class="n">beauty_name</span> <span class="p">]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">level</span>
                <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">header</span> <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Any other section</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">Section</span><span class="p">()</span>
                <span class="n">node</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">name</span>
                <span class="n">node</span><span class="o">.</span><span class="n">title_norm</span> <span class="o">=</span> <span class="n">beauty_name</span>
                <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">level</span>
                <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">header</span> <span class="p">)</span>

            <span class="c1"># hierarchy</span>
            <span class="k">if</span> <span class="n">last</span> <span class="ow">is</span> <span class="n">root</span><span class="p">:</span>
                <span class="c1"># top-level node</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">last</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>

            <span class="k">elif</span> <span class="n">header</span><span class="o">.</span><span class="n">level</span> <span class="o">&gt;</span> <span class="n">last</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
                <span class="c1"># child node</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">last</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>

            <span class="k">elif</span> <span class="n">header</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">last</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
                <span class="c1"># same level node</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">parent</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># parent node</span>
                <span class="c1"># find parent</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">last</span>

                <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">root</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">level</span> <span class="o">&gt;</span> <span class="n">parent</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span>

                <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>

            <span class="c1"># index by name</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">sections_by_name</span><span class="p">[</span> <span class="n">beauty_name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">node</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># text block</span>
            <span class="n">last</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">lexem</span> <span class="p">)</span>
            <span class="c1"># index by class</span>
            <span class="n">last</span><span class="o">.</span><span class="n">lexemes_by_class</span><span class="p">[</span> <span class="nb">type</span><span class="p">(</span> <span class="n">lexem</span> <span class="p">)</span> <span class="p">][</span> <span class="n">lexem</span><span class="o">.</span><span class="n">name</span> <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">lexem</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">root</span></div>


<div class="viewcode-block" id="extract_raw_text"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.extract_raw_text">[docs]</a><span class="k">def</span> <span class="nf">extract_raw_text</span><span class="p">(</span> <span class="n">toc</span><span class="p">:</span> <span class="n">Root</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It for converting extlanations from &#39;# An animal of the family [[Felidae]]:&#39; to &#39;An animal of the family Felidae:&#39;</span>

<span class="sd">    It scan all lexemes for:</span>

<span class="sd">    - explanation, like the:</span>
<span class="sd">    - templates: {{en-noun}}, {{en-adj}},...</span>
<span class="sd">    - translations: {{trans-see}}, {{trans-top}}</span>
<span class="sd">    - senses: {{sense}}, {{ws sense}}</span>

<span class="sd">    It collect all values raw-text for send to Wiktionary API, for get clean human readable text.</span>

<span class="sd">    Args:</span>
<span class="sd">        toc (Root):     TOC root.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list)  raw-text strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#     extract sense raw-text</span>
    <span class="c1">#       nodes for convert raw to text</span>
    <span class="c1">#       explanation</span>
    <span class="c1">#       explanation-example</span>
    <span class="c1">#       {{trans-top|...}}</span>
    <span class="c1">#       =synonyms= /  Li</span>
    <span class="c1">#     fill node.sense_raw</span>

    <span class="n">raws</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">toc</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span> <span class="n">Section</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">node</span><span class="p">,</span> <span class="n">Explanation</span> <span class="p">):</span>
            <span class="c1"># explanation.raw-text</span>
            <span class="n">li</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">raws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">li</span><span class="o">.</span><span class="n">raw</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">node</span><span class="p">,</span> <span class="n">ExplanationExample</span> <span class="p">):</span>
            <span class="c1"># explanation example.raw-text</span>
            <span class="n">li</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">raws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">li</span><span class="o">.</span><span class="n">raw</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># templates</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">find_lexem</span><span class="p">(</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">Template</span> <span class="p">):</span>
                    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sense&#39;</span><span class="p">:</span>
                        <span class="n">raw</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">raws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">raw</span> <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;trans-top&#39;</span><span class="p">:</span>
                        <span class="n">raw</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">raws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">raw</span> <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;trans-see&#39;</span><span class="p">:</span>
                        <span class="n">raw</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">raws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">raw</span> <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ws sense&#39;</span><span class="p">:</span>
                        <span class="n">raw</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">raws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">raw</span> <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">{</span>
                        <span class="s1">&#39;en-noun&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-verb,&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-adj&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-adv&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-prep&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-inter&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-symbol&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-punctuationmark&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-proverb&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-propn&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-propernoun&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-proper-noun&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-prop&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-pron&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-pronoun&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-prepphrase&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-phrase&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-prepositionalphrase&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-preposition&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-pp&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-prep&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-prefix&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-suffix&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-pluralnoun&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-plural-noun&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-pastof&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-particle&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-part&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-intj&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-interjection&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-inter&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-interj&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-initialism&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-ingformof&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-det&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-decades&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-contraction&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-cont&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-conjunction&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-conj&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-conj-simple&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-con&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-comparativeof&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-cat&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-adverb&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-adv&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-adj&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;en-abbr&#39;</span><span class="p">,</span>
                    <span class="p">}:</span>
                        <span class="n">raw</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">raw</span>
                        <span class="n">raws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">raw</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">raws</span></div>


<div class="viewcode-block" id="make_explanations_tree"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.make_explanations_tree">[docs]</a><span class="k">def</span> <span class="nf">make_explanations_tree</span><span class="p">(</span> <span class="n">lexemes</span><span class="p">:</span> <span class="nb">list</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExplanationsRoot</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It take lexems like the:</span>

<span class="sd">    ::</span>

<span class="sd">        # An animal of the family [[Felidae]]:</span>
<span class="sd">        #* {{quote-book|en|year=2011|author=Karl Kruszelnicki|title=Brain Food|isbn=1466828129|page=53|passage=Mammals need two genes to make the taste receptor for sugar. Studies in various &#39;&#39;&#39;cats&#39;&#39;&#39; (tigers, cheetahs and domestic cats) showed that one of these genes has mutated and no longer works.}}</span>
<span class="sd">        #: {{syn|en|felid}}</span>
<span class="sd">        ## A domesticated [[subspecies]] (&#39;&#39;[[Felis silvestris catus]]&#39;&#39;) of [[feline]] animal, commonly kept as a house [[pet]]. {{defdate|from 8&lt;sup&gt;th&lt;/sup&gt;c.}}</span>
<span class="sd">        ##* {{RQ:WBsnt IvryGt|II}}</span>
<span class="sd">        ##*: At twilight in the summer there is never anybody to fear—man, woman, or &#39;&#39;&#39;cat&#39;&#39;&#39;—in the chambers and at that hour the mice come out. They do not eat parchment or foolscap or red tape, but they eat the luncheon crumbs.</span>
<span class="sd">        ##: {{syn|en|puss|pussy|malkin|kitty|pussy-cat|grimalkin|Thesaurus:cat}}</span>
<span class="sd">        ## Any similar animal of the family [[Felidae]], which includes [[lion]]s, [[tiger]]s, bobcats, etc.</span>

<span class="sd">    and build tree like the:</span>

<span class="sd">    ::</span>

<span class="sd">          1.2.1.ex.1. # An animal of the family [[Felidae]]:</span>
<span class="sd">            1.2.1.ex.1.1. #* {{quote-book|en|year=2011|author=Karl Kruszelnicki|title=Brain Food|isbn=1466828129|page=53|passage=Mammals need two genes to make the taste receptor for sugar. Studies in various &#39;&#39;&#39;cats&#39;&#39;&#39; (tigers, cheetahs and domestic cats) showed that one of these genes has mutated and no longer works.}}</span>
<span class="sd">            1.2.1.ex.1.:1. #: {{syn|en|felid}}</span>
<span class="sd">            1.2.1.ex.1.2. ## A domesticated [[subspecies]] (&#39;&#39;[[Felis silvestris catus]]&#39;&#39;) of [[feline]] animal, commonly kept as a house [[pet]]. {{defdate|from 8&lt;sup&gt;th&lt;/sup&gt;c.}}</span>
<span class="sd">              1.2.1.ex.1.2.1. ##* {{RQ:WBsnt IvryGt|II}}</span>
<span class="sd">                1.2.1.ex.1.2.1.:1. ##*: At twilight in the summer there is never anybody to fear—man, woman, or &#39;&#39;&#39;cat&#39;&#39;&#39;—in the chambers and at that hour the mice come out. They do not eat parchment or foolscap or red tape, but they eat the luncheon crumbs.</span>
<span class="sd">              1.2.1.ex.1.2.:1. ##: {{syn|en|puss|pussy|malkin|kitty|pussy-cat|grimalkin|Thesaurus:cat}}</span>
<span class="sd">            1.2.1.ex.1.3. ## Any similar animal of the family [[Felidae]], which includes [[lion]]s, [[tiger]]s, bobcats, etc.</span>

<span class="sd">    Tree uses for detect child/parent explanations, child examples.</span>

<span class="sd">    Args:</span>
<span class="sd">        lexemes (list):  explanation lexems. It all starts from &#39;#&#39;, &#39;*&#39;, &#39;:&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Root)  New table of contents (TOC)  root</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make toc</span>
    <span class="c1"># Add childs to parents</span>
    <span class="c1"># Add examples to explanations</span>
    <span class="k">def</span> <span class="nf">is_a_contain_b</span><span class="p">(</span> <span class="n">a</span><span class="p">:</span> <span class="n">Section</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Section</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">a_base</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">lexemes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">base</span>
        <span class="n">b_base</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">lexemes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">base</span>

        <span class="k">if</span> <span class="n">b_base</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span> <span class="n">a_base</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">b_base</span> <span class="o">==</span> <span class="n">a_base</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">ExplanationsRoot</span><span class="p">()</span>
    <span class="n">root</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Explanations&#39;</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">root</span>

    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">lexemes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">Explanation</span><span class="p">()</span>
            <span class="n">node</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">raw</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">li</span> <span class="p">)</span>

        <span class="k">elif</span> <span class="n">li</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">ExplanationExample</span><span class="p">()</span>
            <span class="n">node</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">raw</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">li</span> <span class="p">)</span>

        <span class="k">elif</span> <span class="n">li</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">ExplanationLi</span><span class="p">()</span>
            <span class="n">node</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">raw</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">li</span> <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">Explanation</span><span class="p">()</span>
            <span class="n">node</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">raw</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">li</span> <span class="p">)</span>

        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">last</span> <span class="ow">is</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>

        <span class="k">elif</span> <span class="n">is_a_contain_b</span><span class="p">(</span> <span class="n">last</span><span class="p">,</span> <span class="n">node</span> <span class="p">):</span>
            <span class="n">last</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">root</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_a_contain_b</span><span class="p">(</span> <span class="n">last</span><span class="p">,</span> <span class="n">node</span> <span class="p">):</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">last</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">parent</span>

            <span class="n">last</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">node</span>

    <span class="k">return</span> <span class="n">root</span></div>


<div class="viewcode-block" id="get_label_type"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.get_label_type">[docs]</a><span class="k">def</span> <span class="nf">get_label_type</span><span class="p">(</span> <span class="n">expl</span><span class="p">,</span> <span class="n">item</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return LabelType for item.</span>

<span class="sd">    Args:</span>
<span class="sd">        expl (Explanation):         Explanation</span>
<span class="sd">        item (WikictionaryItem):    WikictionaryItem</span>

<span class="sd">    Returns:</span>
<span class="sd">        (str)   LabelType</span>

<span class="sd">    ::</span>

<span class="sd">        LabelType for &#39;cat&#39; for explanation</span>
<span class="sd">            ## A domesticated [[subspecies]] (&#39;&#39;[[Felis silvestris catus]]&#39;&#39;) of [[feline]] animal, commonly kept as a house [[pet]]. {{defdate|from 8&lt;sup&gt;th&lt;/sup&gt;c.}}</span>
<span class="sd">        is:</span>
<span class="sd">            &quot;Noun_DEFDATE_Subspecies_Silvestris_Feline&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wt</span> <span class="o">=</span> <span class="n">proper</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Extract the list of item enclosed in {{ }}</span>
    <span class="c1"># For each item found , if there is | inside , then split and take only longest word</span>
    <span class="c1"># Convert all non 0-9 A-Z into _</span>
    <span class="c1"># Deduplicate _ _ into single _</span>
    <span class="c1"># Make all words in upper case</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">expl</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">Template</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">li</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">expl</span><span class="o">.</span><span class="n">find_objects</span><span class="p">((</span><span class="n">Li</span><span class="p">,</span> <span class="n">Dl</span><span class="p">))]):</span>
        <span class="n">inner</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">raw</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">convert_to_alnum</span><span class="p">(</span><span class="n">inner</span> <span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">deduplicate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="n">words</span> <span class="o">+=</span> <span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">get_lognest_word</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">list1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="c1"># Extract the list of item enclosed in [[ ]]</span>
    <span class="c1"># For each item found , if there is | inside , then split and take only longest word</span>
    <span class="c1"># Convert all non 0-9 A-Z into _</span>
    <span class="c1"># Deduplicate _ _ into single _</span>
    <span class="c1"># Make all words with first letter uppercase and others lower case (propercase)</span>
    <span class="n">list2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">expl</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">Link</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">li</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">expl</span><span class="o">.</span><span class="n">find_objects</span><span class="p">((</span><span class="n">Li</span><span class="p">,</span> <span class="n">Dl</span><span class="p">))]):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">convert_to_alnum</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">deduplicate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
                <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">get_lognest_word</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">proper</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="c1"># remove all [ ( { ) ] } from the line, and extract all words separated by spaces</span>
    <span class="c1"># keep only words having a lenght&gt;=3</span>
    <span class="c1"># Convert all non 0-9 A-Z into _</span>
    <span class="c1"># Deduplicate _ _ into single _</span>
    <span class="c1"># Make all words in lowercase</span>
    <span class="n">list3</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">expl</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">li</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">expl</span><span class="o">.</span><span class="n">find_objects</span><span class="p">((</span><span class="n">Li</span><span class="p">,</span> <span class="n">Dl</span><span class="p">))]):</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>

    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">deduplicate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">convert_to_alnum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">deduplicate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>

    <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="n">list3</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">]</span>

    <span class="c1"># Add TYPE + (the 4 first items of the concatenated list :  list1 + List2 + list3</span>
    <span class="c1"># Concat</span>
    <span class="n">biglst</span> <span class="o">=</span> <span class="n">list1</span> <span class="o">+</span> <span class="n">list2</span> <span class="o">+</span> <span class="n">list3</span>

    <span class="k">return</span> <span class="n">wt</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">biglst</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span></div>


<div class="viewcode-block" id="get_leaf_explanation_nodes"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.get_leaf_explanation_nodes">[docs]</a><span class="k">def</span> <span class="nf">get_leaf_explanation_nodes</span><span class="p">(</span> <span class="n">root</span><span class="p">:</span> <span class="n">Section</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return all leaf explanations.</span>

<span class="sd">    Args:</span>
<span class="sd">        root (Section):     Explanations tree root</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list)  All leaf explanatins</span>

<span class="sd">    ::</span>

<span class="sd">        # for</span>
<span class="sd">          1.2.1.ex.1. # An animal of the family [[Felidae]]:</span>
<span class="sd">            1.2.1.ex.1.1. #* {{quote-book|en|year=2011|author=Karl Kruszelnicki|title=Brain Food|isbn=1466828129|page=53|passage=Mammals need two genes to make the taste receptor for sugar. Studies in various &#39;&#39;&#39;cats&#39;&#39;&#39; (tigers, cheetahs and domestic cats) showed that one of these genes has mutated and no longer works.}}</span>
<span class="sd">            1.2.1.ex.1.:1. #: {{syn|en|felid}}</span>
<span class="sd">            1.2.1.ex.1.2. ## A domesticated [[subspecies]] (&#39;&#39;[[Felis silvestris catus]]&#39;&#39;) of [[feline]] animal, commonly kept as a house [[pet]]. {{defdate|from 8&lt;sup&gt;th&lt;/sup&gt;c.}}</span>
<span class="sd">              1.2.1.ex.1.2.1. ##* {{RQ:WBsnt IvryGt|II}}</span>
<span class="sd">                1.2.1.ex.1.2.1.:1. ##*: At twilight in the summer there is never anybody to fear—man, woman, or &#39;&#39;&#39;cat&#39;&#39;&#39;—in the chambers and at that hour the mice come out. They do not eat parchment or foolscap or red tape, but they eat the luncheon crumbs.</span>
<span class="sd">              1.2.1.ex.1.2.:1. ##: {{syn|en|puss|pussy|malkin|kitty|pussy-cat|grimalkin|Thesaurus:cat}}</span>
<span class="sd">            1.2.1.ex.1.3. ## Any similar animal of the family [[Felidae]], which includes [[lion]]s, [[tiger]]s, bobcats, etc.</span>
<span class="sd">              1.2.1.ex.1.3.1. ##* {{quote-book|en|year=1977|author=Peter Hathaway Capstick|title=Death in the Long Grass: A Big Game Hunter&#39;s Adventures in the African Bush|publisher=St. Martin&#39;s Press|page=44|passage=I grabbed it and ran over to the lion from behind, the &#39;&#39;&#39;cat&#39;&#39;&#39; still chewing thoughtfully on Silent&#39;s arm.}}</span>
<span class="sd">              1.2.1.ex.1.3.2. ##* &#39;&#39;&#39;1985&#39;&#39;&#39; January, George Laycock, &quot;Our American Lion&quot;, in Boy Scouts of America, &#39;&#39;Boy&#39;s Life&#39;&#39;, 28.</span>
<span class="sd">                1.2.1.ex.1.3.2.:1. ##*: If you should someday round a corner on the hiking trail and come face to face with a mountain lion, you would probably never forget the mighty &#39;&#39;&#39;cat&#39;&#39;&#39;.</span>
<span class="sd">              1.2.1.ex.1.3.3. ##* {{quote-book|en|year=2014|author=Dale Mayer|title=Rare Find. A Psychic Visions Novel|publisher=Valley Publishing|passage=She felt privileged to be here, living the experience inside the majestic &#39;&#39;&#39;cat&#39;&#39;&#39; [i.e. a tiger]; privileged to be part of their bond, even for only a few hours.}}</span>

<span class="sd">        # leafs is:</span>
<span class="sd">            1.2.1.ex.1.2. ## A domesticated [[subspecies]] (&#39;&#39;[[Felis silvestris catus]]&#39;&#39;) of [[feline]] animal, commonly kept as a house [[pet]]. {{defdate|from 8&lt;sup&gt;th&lt;/sup&gt;c.}}</span>
<span class="sd">            1.2.1.ex.1.3. ## Any similar animal of the family [[Felidae]], which includes [[lion]]s, [[tiger]]s, bobcats, etc.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">leaf_explanations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_explanation_sections</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf_explanation</span><span class="p">:</span>
            <span class="n">leaf_explanations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">leaf_explanations</span></div>


<div class="viewcode-block" id="add_explanations"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.add_explanations">[docs]</a><span class="k">def</span> <span class="nf">add_explanations</span><span class="p">(</span> <span class="n">toc</span><span class="p">:</span> <span class="n">Root</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It :</span>

<span class="sd">    - get Table of contents tree</span>
<span class="sd">    - then find explanations in each Part-of-speech section</span>
<span class="sd">    - then from extracted explanations build explanations tree</span>
<span class="sd">    - then add explanations tree into source Table of contents tree</span>

<span class="sd">    Args:</span>
<span class="sd">        toc (Root):  Table of contents (toc) root</span>

<span class="sd">    Returns:</span>
<span class="sd">        It modified source tree `toc`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">toc</span><span class="o">.</span><span class="n">find_part_of_speech_sections</span><span class="p">():</span>
        <span class="p">(</span><span class="n">explanations</span><span class="p">,</span> <span class="n">lexems2</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">extract_explanations</span><span class="p">()</span>

        <span class="n">node</span><span class="o">.</span><span class="n">lexems</span> <span class="o">=</span> <span class="n">lexems2</span>

        <span class="n">ex_tree</span> <span class="o">=</span> <span class="n">make_explanations_tree</span><span class="p">(</span> <span class="n">explanations</span> <span class="p">)</span>

        <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ex_tree</span> <span class="p">)</span></div>


<div class="viewcode-block" id="make_lists_same_length"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.make_lists_same_length">[docs]</a><span class="k">def</span> <span class="nf">make_lists_same_length</span><span class="p">(</span> <span class="n">a</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">list</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make two lists same length. Add to smaller list items with None.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (list):   list 1</span>
<span class="sd">        b (list):   lsit 2</span>

<span class="sd">    Returns:</span>
<span class="sd">        nothing to return. it modifies source lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span> <span class="n">b</span> <span class="p">):</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span> <span class="n">b</span> <span class="p">):</span>
        <span class="n">b</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span> <span class="n">b</span> <span class="p">):</span>
        <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="convert_raw_to_txt"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.convert_raw_to_txt">[docs]</a><span class="k">def</span> <span class="nf">convert_raw_to_txt</span><span class="p">(</span> <span class="n">page_title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">raws</span><span class="p">:</span> <span class="nb">list</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="n">converted</span> <span class="o">=</span> <span class="n">Scrapper_Wiktionary_RemoteAPI</span><span class="o">.</span><span class="n">expand_templates</span><span class="p">(</span> <span class="n">page_title</span><span class="p">,</span> <span class="n">raws</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">converted</span></div>


<div class="viewcode-block" id="mark_leaf_explanation_nodes"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.mark_leaf_explanation_nodes">[docs]</a><span class="k">def</span> <span class="nf">mark_leaf_explanation_nodes</span><span class="p">(</span> <span class="n">root</span><span class="p">:</span> <span class="n">Root</span> <span class="p">):</span>
    <span class="n">has_childs_with_explanation</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># recursive</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
        <span class="n">has_in_childs</span> <span class="o">=</span> <span class="n">mark_leaf_explanation_nodes</span><span class="p">(</span> <span class="n">child</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">has_in_childs</span><span class="p">:</span>
            <span class="n">has_childs_with_explanation</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># check</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">root</span><span class="p">,</span> <span class="n">Explanation</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">has_childs_with_explanation</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">is_leaf_explanation</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">has_childs_with_explanation</span></div>


<div class="viewcode-block" id="update_index_in_toc"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.update_index_in_toc">[docs]</a><span class="k">def</span> <span class="nf">update_index_in_toc</span><span class="p">(</span> <span class="n">root</span><span class="p">:</span> <span class="n">Section</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index_pos</span><span class="o">=</span><span class="s1">&#39;&#39;</span>  <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update string prefix, like the: 1.1. in each section.</span>

<span class="sd">    Args:</span>
<span class="sd">        root:       TOC root</span>
<span class="sd">        level:      - used in recursion</span>
<span class="sd">        prefix:     - used in recursion</span>
<span class="sd">        index_pos:  - used in recursion</span>

<span class="sd">    Returns:</span>
<span class="sd">        it change nodes attribute `index_in_toc` in tree</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># text counter</span>
    <span class="c1"># list counter</span>
    <span class="c1"># header counter</span>
    <span class="c1"># li counter</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">()</span>
    <span class="n">counter</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counter</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counter</span><span class="p">[</span><span class="s1">&#39;li&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counter</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counter</span><span class="p">[</span><span class="s1">&#39;:&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># counter[&#39;trans_top&#39;] = 0</span>

    <span class="n">node</span><span class="p">:</span> <span class="n">Section</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">node</span><span class="p">,</span> <span class="n">ExplanationsRoot</span> <span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">index_in_toc</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;ex.&#39;</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">node</span><span class="p">,</span> <span class="n">ExplanationExample</span> <span class="p">):</span>
            <span class="c1">#</span>
            <span class="n">counter</span><span class="p">[</span> <span class="s1">&#39;:&#39;</span> <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">node</span><span class="o">.</span><span class="n">index_in_toc</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">counter</span><span class="p">[</span><span class="s1">&#39;:&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">node</span><span class="o">.</span><span class="n">index_in_toc</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">i</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>

        <span class="c1"># index_in_pos</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">node</span><span class="p">,</span> <span class="n">PartOfSpeech</span> <span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">index_pos</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">index_in_toc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">index_pos</span> <span class="o">=</span> <span class="n">index_pos</span>

        <span class="c1"># recursive</span>
        <span class="n">update_index_in_toc</span><span class="p">(</span> <span class="n">node</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">index_in_toc</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">index_pos</span> <span class="p">)</span></div>


<div class="viewcode-block" id="remove_other_langs"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.remove_other_langs">[docs]</a><span class="k">def</span> <span class="nf">remove_other_langs</span><span class="p">(</span> <span class="n">toc</span><span class="p">:</span> <span class="n">Root</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove non English languages from tree</span>

<span class="sd">    Args:</span>
<span class="sd">        toc (Root): TOC tree root</span>

<span class="sd">    Returns:</span>
<span class="sd">        nothing to return. it change source tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">to_keep</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># find current lang</span>
    <span class="c1"># get root node</span>
    <span class="c1"># remove all other sections</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">toc</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span> <span class="n">Section</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">title_norm</span> <span class="ow">in</span> <span class="n">LANG_SECTIONS_INDEX</span><span class="p">:</span>
            <span class="n">to_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span>

    <span class="c1"># collect nodes for remove</span>
    <span class="k">if</span> <span class="n">to_keep</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">to_keep</span><span class="p">:</span>
            <span class="c1"># take lang-same-level nodes</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">lang</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="n">lang</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span>

            <span class="c1"># remove</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
                <span class="n">lang</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span></div>


<div class="viewcode-block" id="trans_see_finder"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.trans_see_finder">[docs]</a><span class="k">def</span> <span class="nf">trans_see_finder</span><span class="p">(</span> <span class="n">toc</span><span class="p">:</span> <span class="n">Root</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It helper help find Templates with name &#39;trans-see&#39;.</span>

<span class="sd">    Uses for get translations from external pages.</span>

<span class="sd">    Args:</span>
<span class="sd">        toc (Root): Table-of-contents (toc) root</span>

<span class="sd">    Returns:</span>
<span class="sd">        Iterator of tuples: (node, template)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">toc</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span> <span class="n">Translations</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">lexemes_by_class</span><span class="p">[</span> <span class="n">Template</span> <span class="p">][</span> <span class="s1">&#39;trans-see&#39;</span> <span class="p">]:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="add_translations_from_trans_see"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.add_translations_from_trans_see">[docs]</a><span class="k">def</span> <span class="nf">add_translations_from_trans_see</span><span class="p">(</span> <span class="n">page</span><span class="p">,</span> <span class="n">toc</span><span class="p">:</span> <span class="n">Root</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find links to external pages, and fetch page contents, and add translations.</span>

<span class="sd">    It make calls to Wiktionary API for fetch page contents. Then contents parsed.</span>

<span class="sd">    ::</span>

<span class="sd">        1. find all {{trans-see|...}}</span>
<span class="sd">        2. request page via wiktionary API</span>
<span class="sd">        3. parse page -&gt; lexemes + toc</span>
<span class="sd">        4. make search index:  dict[ English ][ Noun ] = Translations</span>
<span class="sd">        5. check</span>
<span class="sd">                - English / Verb / Translations     -&gt;      English / Verb / Translations   - is better better better</span>
<span class="sd">                - Verb / Translations               -&gt;      None    / Verb / Translations   - is better better</span>
<span class="sd">                - English / Translations            -&gt;      English / None / Translations   - is better</span>
<span class="sd">                - English / Synonyms / Translations -&gt;      None    / None / Translations   - is good</span>
<span class="sd">                - Translations                      -&gt;      None    / None / Translations   - is good</span>
<span class="sd">        6. get trarnslation lexemes. add to node =Translations=</span>
<span class="sd">        7. save fetch page titles for prevent recursion</span>

<span class="sd">    Args:</span>
<span class="sd">        page (Page):    Page instance</span>
<span class="sd">        toc:            TOC root</span>

<span class="sd">    Returns:</span>
<span class="sd">        nothing to return. It change TOC tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1. find all {{trans-see|...}}</span>
    <span class="c1"># 2. request page via wiktionary API</span>
    <span class="c1"># 3. parse page -&gt; lexemes + toc</span>
    <span class="c1"># 4. make search index:  dict[ English ][ Noun ][ Translations ] = node</span>
    <span class="c1"># 5. check:</span>
    <span class="c1">#      dict[ English ][ Noun ] == current_node.part_of_speech</span>
    <span class="c1">#      dict[ Noun ] == current_node.part_of_speech</span>
    <span class="c1">#      dict[ Translations ]</span>
    <span class="c1"># 6. get trarnslation lexemes. add to node =Translations=</span>
    <span class="c1"># save fetch page titles for prevent recursion</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># 1. find all {{trans-see|...}}</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">Translations</span>
    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trans_see_finder</span><span class="p">(</span> <span class="n">toc</span> <span class="p">):</span>
        <span class="c1"># found</span>
        <span class="n">full_url</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">full_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># split cat/translations#Noun  -&gt;  (cat/translations, Noun)</span>
        <span class="n">page_url</span> <span class="o">=</span> <span class="n">full_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># skip self</span>
        <span class="k">if</span> <span class="n">page_url</span> <span class="o">==</span> <span class="n">page</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># skip already fetched</span>
        <span class="k">if</span> <span class="n">page_url</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># 2. request to wiktionary API</span>
        <span class="n">raw_text</span> <span class="o">=</span> <span class="n">Scrapper_Wiktionary_RemoteAPI</span><span class="o">.</span><span class="n">get_wikitext</span><span class="p">(</span> <span class="n">page_url</span> <span class="p">)</span>

        <span class="c1"># keep fetched title</span>
        <span class="n">pages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">page_url</span> <span class="p">)</span>

        <span class="c1"># if page not exists - next</span>
        <span class="k">if</span> <span class="n">raw_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># 3. parse page -&gt; lexemes + toc</span>
        <span class="n">ts_lexemes</span> <span class="o">=</span> <span class="n">Scrapper_Wiktionary_WikitextParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="n">raw_text</span> <span class="p">)</span>
        <span class="n">ts_toc</span> <span class="o">=</span> <span class="n">make_table_of_contents</span><span class="p">(</span> <span class="n">ts_lexemes</span> <span class="p">)</span>
        <span class="n">update_index_in_toc</span><span class="p">(</span> <span class="n">ts_toc</span> <span class="p">)</span>
        <span class="c1"># ts_toc.dump()</span>

        <span class="c1"># 4. make search index:  dict[ English ][ Noun ][ Translations ] = (node, t)</span>
        <span class="c1"># example:</span>
        <span class="c1">#    English</span>
        <span class="c1">#      Noun</span>
        <span class="c1">#        Translations</span>
        <span class="c1">#          {{trans-top}}</span>
        <span class="c1">#      Verb</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span> <span class="nb">list</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c1"># find =Translations=</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">ts_toc</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span> <span class="n">Translations</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
            <span class="n">pos</span>  <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">get_parent_pos_node</span><span class="p">()</span>   <span class="k">if</span> <span class="n">ts</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>   <span class="k">else</span> <span class="kc">None</span>
            <span class="n">lang</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">get_parent_lang_node</span><span class="p">()</span> <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>   <span class="k">else</span> <span class="kc">None</span>

            <span class="n">spos</span>  <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">title_norm</span>  <span class="k">if</span> <span class="n">pos</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">slang</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="n">title_norm</span> <span class="k">if</span> <span class="n">lang</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="c1"># dict[ English ][ Noun ] = translations_node</span>
            <span class="n">d</span><span class="p">[</span> <span class="n">slang</span> <span class="p">][</span> <span class="n">spos</span> <span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>

            <span class="c1"># English / Verb / Translations     -&gt;      English / Verb / Translations   - is better better better</span>
            <span class="c1"># Verb / Translations               -&gt;      None    / Verb / Translations   - is better better</span>
            <span class="c1"># English / Translations            -&gt;      English / None / Translations   - is better</span>
            <span class="c1"># English / Synonyms / Translations -&gt;      None    / None / Translations   - is good</span>
            <span class="c1"># Translations                      -&gt;      None    / None / Translations   - is good</span>


        <span class="c1"># 5. check:</span>
        <span class="c1">#    dict[ English ][ Verb ][ Translations ]</span>
        <span class="c1">#    dict[ English ][ None ][ Translations ]</span>
        <span class="c1">#    dict[ None    ][ Verb ][ Translations ]</span>
        <span class="c1">#    dict[ None    ][ None ][ Translations ]</span>
        <span class="c1">#    {{trans-top}}</span>
        <span class="n">current_ts</span>   <span class="o">=</span> <span class="n">node</span>
        <span class="n">current_pos</span>  <span class="o">=</span> <span class="n">current_ts</span><span class="o">.</span><span class="n">get_parent_pos_node</span><span class="p">()</span>
        <span class="n">current_lang</span> <span class="o">=</span> <span class="n">current_pos</span><span class="o">.</span><span class="n">get_parent_lang_node</span><span class="p">()</span>   <span class="k">if</span> <span class="n">current_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>   <span class="k">else</span> <span class="kc">None</span>

        <span class="n">cpos</span>  <span class="o">=</span>  <span class="n">current_pos</span><span class="o">.</span><span class="n">title_norm</span>  <span class="k">if</span> <span class="n">current_pos</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>   <span class="k">else</span> <span class="kc">None</span>
        <span class="n">clang</span> <span class="o">=</span>  <span class="n">current_lang</span><span class="o">.</span><span class="n">title_norm</span> <span class="k">if</span> <span class="n">current_lang</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>   <span class="k">else</span> <span class="kc">None</span>

        <span class="c1">#</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">d</span><span class="p">[</span> <span class="n">clang</span> <span class="p">][</span> <span class="n">cpos</span> <span class="p">],</span>     <span class="c1"># ib betted betted betted</span>
            <span class="n">d</span><span class="p">[</span> <span class="n">clang</span> <span class="p">][</span> <span class="kc">None</span> <span class="p">],</span>     <span class="c1"># ib betted betted</span>
            <span class="n">d</span><span class="p">[</span> <span class="kc">None</span>  <span class="p">][</span> <span class="n">cpos</span> <span class="p">],</span>     <span class="c1"># ib betted</span>
            <span class="n">d</span><span class="p">[</span> <span class="kc">None</span>  <span class="p">][</span> <span class="kc">None</span> <span class="p">],</span>     <span class="c1"># ib good</span>
        <span class="p">]</span>

        <span class="c1"># 6. get all from external page =Trarnslations=.</span>
        <span class="c1">#    add to node =Translations=</span>
        <span class="n">ts_translations_node</span><span class="p">:</span> <span class="n">Translations</span>
        <span class="k">for</span> <span class="n">ts_translations_node</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">Translations</span> <span class="p">),</span> <span class="n">checks</span> <span class="p">):</span>
            <span class="c1"># append lexemes</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">ts_translations_node</span><span class="o">.</span><span class="n">lexemes</span> <span class="p">)</span>
            <span class="c1"># update index</span>
            <span class="c1"># index by class</span>
            <span class="k">for</span> <span class="n">lexem</span> <span class="ow">in</span> <span class="n">ts_translations_node</span><span class="o">.</span><span class="n">lexemes</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">lexemes_by_class</span><span class="p">[</span> <span class="nb">type</span><span class="p">(</span> <span class="n">lexem</span> <span class="p">)</span> <span class="p">][</span> <span class="n">lexem</span><span class="o">.</span><span class="n">name</span> <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">lexem</span> <span class="p">)</span></div>


<div class="viewcode-block" id="update_popularity_of_word"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.update_popularity_of_word">[docs]</a><span class="k">def</span> <span class="nf">update_popularity_of_word</span><span class="p">(</span> <span class="n">item</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate and update field PopularityOfWord.</span>

<span class="sd">    Please, see source.</span>

<span class="sd">    Args:</span>
<span class="sd">        item (WikictionaryItem):    item</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span><span class="o">.</span><span class="n">PopularityOfWord</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">ExplainationExamplesRaw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">item</span><span class="o">.</span><span class="n">PopularityOfWord</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">ExplainationExamplesRaw</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">RelatedTerms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">item</span><span class="o">.</span><span class="n">PopularityOfWord</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">RelatedTerms</span> <span class="p">)</span>

    <span class="n">other_cost</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_DE</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_DE</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_EN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_EN</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_ES</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_ES</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_FR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_FR</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_IT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_IT</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_PT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_PT</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_RU</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Translation_RU</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Holonymy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Holonymy</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Troponymy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Troponymy</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Hypernymy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Hypernymy</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Hyponymy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Hyponymy</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Meronymy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Meronymy</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Synonymy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Synonymy</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">Antonymy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_cost</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">Antonymy</span> <span class="p">)</span>

    <span class="n">item</span><span class="o">.</span><span class="n">PopularityOfWord</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">other_cost</span> <span class="k">else</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="check_structure"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.check_structure">[docs]</a><span class="k">def</span> <span class="nf">check_structure</span><span class="p">(</span> <span class="n">toc</span><span class="p">:</span> <span class="n">Root</span> <span class="p">):</span>
    <span class="c1"># for each valuable section</span>
    <span class="c1">#   check parent: parent must not can be same valuable section</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">toc</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span> <span class="p">(</span><span class="n">Translations</span><span class="p">,</span> <span class="n">Synonyms</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="scrap"><a class="viewcode-back" href="../../../docstring/wiktionary.en.html#wiktionary.en.Scrapper_Wiktionary_EN.scrap">[docs]</a><span class="k">def</span> <span class="nf">scrap</span><span class="p">(</span> <span class="n">page</span><span class="p">:</span> <span class="n">Scrapper_Wiktionary</span><span class="o">.</span><span class="n">Page</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">WikictionaryItem</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main scrap function</span>

<span class="sd">    #. get Page: id, ns, title, raw-text</span>
<span class="sd">    #. parse raw-text -&gt; take lexemes</span>
<span class="sd">    #. keep lexemes. make table-of-contents (toc). toc structure is tree. each branch is header. each node hold lexemes</span>
<span class="sd">    #. take tree. find part-of-speech nodes. take lexemes. find li. convert li to nodes. it is explanations</span>
<span class="sd">    #. take each node. take lexemes. convert lists to tree, wrap text text block with node.</span>

<span class="sd">    Args:</span>
<span class="sd">        page (Page): Page instance</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list)      list of items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1. get Page: id, ns, title, raw-text</span>
    <span class="c1"># 2. parse raw-text -&gt; take lexemes</span>
    <span class="c1"># 3. keep lexemes. make table-of-contents (toc). toc structure is tree. each branch is header. each node hold lexemes</span>
    <span class="c1"># 4. take tree. find part-of-speech nodes. take lexemes. find li. convert li to nodes. it is explanations</span>
    <span class="c1"># 5. take each node. take lexemes. convert lists to tree, wrap text text block with node.</span>
    <span class="n">items</span>  <span class="o">=</span> <span class="p">[]</span>

    <span class="n">lexems</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">to_lexems</span><span class="p">()</span>
    <span class="n">page</span><span class="o">.</span><span class="n">lexems</span> <span class="o">=</span> <span class="n">lexems</span>

    <span class="c1"># make table-of-contents (toc)</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">make_table_of_contents</span><span class="p">(</span> <span class="n">lexems</span> <span class="p">)</span>
    <span class="n">page</span><span class="o">.</span><span class="n">toc</span> <span class="o">=</span> <span class="n">toc</span>
    <span class="n">remove_other_langs</span><span class="p">(</span> <span class="n">toc</span> <span class="p">)</span>

    <span class="c1"># add explanations</span>
    <span class="n">add_explanations</span><span class="p">(</span> <span class="n">toc</span> <span class="p">)</span>
    <span class="n">mark_leaf_explanation_nodes</span><span class="p">(</span> <span class="n">toc</span> <span class="p">)</span>

    <span class="c1"># get all lead explanations</span>
    <span class="n">explanations</span> <span class="o">=</span> <span class="n">get_leaf_explanation_nodes</span><span class="p">(</span> <span class="n">toc</span> <span class="p">)</span>
    <span class="n">page</span><span class="o">.</span><span class="n">explanations</span> <span class="o">=</span> <span class="n">explanations</span>

    <span class="c1"># add translations from {{trans-see|...}}</span>
    <span class="n">add_translations_from_trans_see</span><span class="p">(</span> <span class="n">page</span><span class="p">,</span> <span class="n">toc</span> <span class="p">)</span>

    <span class="c1"># add toc-numbers</span>
    <span class="n">update_index_in_toc</span><span class="p">(</span> <span class="n">toc</span> <span class="p">)</span>
    <span class="c1">#toc.dump()</span>

    <span class="c1"># &#39;{{...}}&#39; -&gt; &#39;Text&#39;</span>
    <span class="c1"># 1. collect all valued raw-text:</span>
    <span class="c1">#      explanation-raw</span>
    <span class="c1">#      {{sense|...}}</span>
    <span class="c1">#      {{trans-top|...}}</span>
    <span class="c1"># 2. convert</span>
    <span class="c1">#    send raw to Wiktionary API</span>
    <span class="c1">#    get txt</span>
    <span class="c1"># 3. save</span>
    <span class="c1">#    saved = {}</span>
    <span class="c1">#    saved[ raw ] = txt</span>
    <span class="c1">#    page.raw_txt = saved</span>

    <span class="c1"># 1. collect</span>
    <span class="n">raws</span> <span class="o">=</span> <span class="n">extract_raw_text</span><span class="p">(</span> <span class="n">toc</span> <span class="p">)</span>
    <span class="n">raws</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">filter</span><span class="p">(</span> <span class="kc">None</span><span class="p">,</span> <span class="n">raws</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c1"># 2. convert raw to txt</span>
    <span class="n">txts</span> <span class="o">=</span> <span class="n">convert_raw_to_txt</span><span class="p">(</span> <span class="n">page</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">raws</span> <span class="p">)</span>

    <span class="c1"># clean li</span>
    <span class="n">txts_cleaned</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">raw</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">raws</span><span class="p">,</span> <span class="n">txts</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">raw</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span> <span class="s1">&#39;#&#39;</span> <span class="p">)</span> <span class="ow">or</span> <span class="n">raw</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span> <span class="s1">&#39;*&#39;</span> <span class="p">)</span> <span class="ow">or</span> <span class="n">raw</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span> <span class="s1">&#39;:&#39;</span> <span class="p">):</span>
            <span class="n">txts_cleaned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">txt</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span> <span class="s1">&#39;#*: &#39;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txts_cleaned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">txt</span> <span class="p">)</span>
    <span class="n">txts</span> <span class="o">=</span> <span class="n">txts_cleaned</span>

    <span class="c1"># 3. keep</span>
    <span class="n">page</span><span class="o">.</span><span class="n">text_by_raw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">raws</span><span class="p">,</span> <span class="n">txts</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c1"># update explanation raw, txt</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">explanations</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">sense_raw</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_sense</span><span class="p">()</span>

        <span class="c1"># get raw of #</span>
        <span class="c1"># concatenate with parents</span>
        <span class="n">sense</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">text_by_raw</span><span class="p">[</span> <span class="n">node</span><span class="o">.</span><span class="n">get_sense</span><span class="p">()</span> <span class="p">]</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">parent</span><span class="p">,</span> <span class="p">(</span><span class="n">Explanation</span><span class="p">,</span> <span class="n">ExplanationLi</span><span class="p">)</span> <span class="p">):</span>
            <span class="n">sense</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">text_by_raw</span><span class="p">[</span> <span class="n">parent</span><span class="o">.</span><span class="n">get_sense</span><span class="p">()</span> <span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">sense</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">node</span><span class="o">.</span><span class="n">sense_txt</span> <span class="o">=</span> <span class="n">sense</span>


    <span class="c1"># Prepare for scrap</span>
    <span class="c1"># now, get all explanation senses</span>
    <span class="n">explanation_by_sense</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">explanations</span><span class="p">:</span>
        <span class="n">explanation_by_sense</span><span class="p">[</span> <span class="n">e</span><span class="o">.</span><span class="n">sense_txt</span> <span class="p">]</span> <span class="o">=</span> <span class="n">e</span>

    <span class="n">page</span><span class="o">.</span><span class="n">explanation_by_sense</span> <span class="o">=</span> <span class="n">explanation_by_sense</span>

    <span class="c1"># get lang module with definitions</span>
    <span class="kn">import</span> <span class="nn">importlib</span>
    <span class="n">lm</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;wiktionary.en.Scrapper_Wiktionary_&quot;</span> <span class="o">+</span> <span class="s1">&#39;EN&#39;</span> <span class="o">+</span> <span class="s1">&#39;_Definitions&#39;</span><span class="p">)</span>

    <span class="n">indexinPage</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Scrap</span>
    <span class="c1"># each explanation</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">explanations</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">item</span>

        <span class="c1"># base attributes</span>
        <span class="n">item</span><span class="o">.</span><span class="n">LabelName</span>     <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">label</span>
        <span class="n">item</span><span class="o">.</span><span class="n">LanguageCode</span>  <span class="o">=</span> <span class="s1">&#39;en&#39;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">SelfUrl</span>       <span class="o">=</span> <span class="s2">&quot;https://en.wiktionary.org/wiki/&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="o">.</span><span class="n">label</span>
        <span class="n">item</span><span class="o">.</span><span class="n">TypeLabelName</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_parent_pos_node</span><span class="p">()</span><span class="o">.</span><span class="n">title</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Senses</span><span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">sense_txt</span>

        <span class="c1"># Index</span>
        <span class="n">indexinPage</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">item</span><span class="o">.</span><span class="n">IndexinPage</span>       <span class="o">=</span> <span class="n">indexinPage</span>
        <span class="n">item</span><span class="o">.</span><span class="n">IndexinToc</span>        <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">index_in_toc</span>
        <span class="n">item</span><span class="o">.</span><span class="n">IndexPartOfSpeech</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">index_pos</span>

        <span class="c1"># Synonyms, Antonyms, Troponyms, Holonyms, Translations_*,...</span>
        <span class="n">check_node</span><span class="p">(</span> <span class="n">page</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">lm</span> <span class="p">)</span>

        <span class="c1"># type</span>
        <span class="n">pos_node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_parent_pos_node</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="n">PART_OF_SPEECH_SECTIONS_INDEX</span><span class="p">[</span> <span class="n">pos_node</span> <span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">]</span>

        <span class="c1"># explanation text</span>
        <span class="n">item</span><span class="o">.</span><span class="n">ExplainationRaw</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_sense</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">ExplainationTxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">text_by_raw</span><span class="p">[</span> <span class="n">item</span><span class="o">.</span><span class="n">ExplainationRaw</span> <span class="p">]</span>
        <span class="n">item</span><span class="o">.</span><span class="n">DescriptionTxt</span>  <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">sense_txt</span>

        <span class="c1"># Example</span>
        <span class="k">for</span> <span class="n">example_node</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">find_example_sections</span><span class="p">():</span>
            <span class="n">item</span><span class="o">.</span><span class="n">ExplainationExamplesRaw</span> <span class="o">=</span> <span class="n">example_node</span><span class="o">.</span><span class="n">lexemes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">raw</span>
            <span class="n">item</span><span class="o">.</span><span class="n">ExplainationExamplesTxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">text_by_raw</span><span class="p">[</span> <span class="n">item</span><span class="o">.</span><span class="n">ExplainationExamplesRaw</span> <span class="p">]</span>
            <span class="k">break</span>  <span class="c1"># first only</span>

        <span class="c1"># LabelType</span>
        <span class="n">item</span><span class="o">.</span><span class="n">LabelType</span> <span class="o">=</span> <span class="n">get_label_type</span><span class="p">(</span> <span class="n">node</span><span class="o">.</span><span class="n">lexemes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span> <span class="p">)</span>

        <span class="c1"># PrimaryKey</span>
        <span class="n">label_type</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">LabelType</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">LabelType</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">PrimaryKey</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">LanguageCode</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">LabelName</span> <span class="o">+</span> <span class="s2">&quot;§&quot;</span> <span class="o">+</span> <span class="n">label_type</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">IndexinPage</span> <span class="p">)</span>

        <span class="c1"># PopularityOfWord </span>
        <span class="n">update_popularity_of_word</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">items</span></div>


<span class="c1"># Explanation</span>
<span class="c1"># #</span>
<span class="c1">#</span>
<span class="c1"># Translations</span>
<span class="c1"># *</span>
<span class="c1"># *</span>
<span class="c1"># *</span>
<span class="c1">#</span>
<span class="c1"># Synonyms</span>
<span class="c1"># *</span>
<span class="c1"># *</span>
<span class="c1"># *</span>
<span class="c1">#</span>

<span class="c1"># extract sentences</span>
<span class="c1"># TocNode</span>
<span class="c1">#   Li - sense</span>
<span class="c1">#   Li - sense</span>
<span class="c1">#   Li - sense</span>

<span class="c1"># 1 Explanation - 1 Sentence</span>
<span class="c1"># node</span>
<span class="c1">#   raw, human_text</span>

<span class="c1"># node.id  -&gt;  &lt;span id=&quot;node-id&quot;&gt;...raw...&lt;/span&gt;  -&gt;  id, human_text  -&gt;  node.id,</span>
<span class="c1">#                                                                           node.raw,</span>
<span class="c1">#                                                                           node.human</span>
<span class="c1">#                                                                           node.sense</span>
<span class="c1">#                                                                           node.words</span>

<span class="c1"># section, id,</span>




<span class="c1"># 1. from Explanation:</span>
<span class="c1">#    from templates                              -&gt; Syn</span>
<span class="c1"># 2. in section Synonyms</span>
<span class="c1">#    - if exists list</span>
<span class="c1">#        - group by list</span>
<span class="c1">#          - with sense</span>
<span class="c1">#          - without sense</span>
<span class="c1">#      else</span>
<span class="c1">#        - from Templates</span>
<span class="c1">#          - with sense</span>
<span class="c1">#          - without sense</span>
<span class="c1">#</span>
<span class="c1">#    if exist {{sense}} - group by sense</span>
<span class="c1">#      then collect to packet</span>
<span class="c1">#      then request to API</span>
<span class="c1">#      then attach to explanation</span>
<span class="c1"># 3. Etymology</span>
<span class="c1">#    add to each explanation                    -&gt; syn</span>
<span class="c1"># 4. Verb</span>
<span class="c1">#    add to each explanation                    -&gt; syn</span>
<span class="c1"># 5. Interjection</span>
<span class="c1">#    add to each explanation                    -&gt; syn</span>
<span class="c1"># 6. Adjective, Dl, Dt                          -&gt; syn</span>
<span class="c1"># 7. Alternative forms                          -&gt; synonym of alternate form?</span>
<span class="c1">#</span>
<span class="c1"># .. where {{syn}} exists ?</span>
<span class="c1">#</span>


<span class="c1"># matcher</span>
<span class="c1"># explanations</span>
<span class="c1">#   # explanation</span>
<span class="c1">#   # explanation</span>
<span class="c1">#   # explanation</span>
<span class="c1"># ==section===</span>
<span class="c1"># * (sentence) [[word]]</span>
<span class="c1"># * (sentence) [[word]]</span>
<span class="c1"># * (sentence) [[word]]</span>
<span class="c1">#</span>
<span class="c1"># match_pks( explanations_block, section_block )</span>
<span class="c1"># match_pks( explanations_node, synonyms_node )</span>
<span class="c1"># match_pks( explanations_node, hyponyms_node )</span>
<span class="c1"># match_pks( explanations_node, translations_node )</span>

<span class="c1"># Lang</span>
<span class="c1">#  POS</span>
<span class="c1">#   Explanations</span>
<span class="c1">#   Synonyms</span>
<span class="c1">#</span>
<span class="c1"># Lang</span>
<span class="c1">#  Etymology</span>
<span class="c1">#   POS</span>
<span class="c1">#    Explanations</span>
<span class="c1">#    Synonyms</span>
<span class="c1">#</span>
<span class="c1"># Lang</span>
<span class="c1">#  Etymology</span>
<span class="c1">#   POS</span>
<span class="c1">#    Explanations</span>
<span class="c1">#   Synonyms</span>
<span class="c1">#</span>
<span class="c1"># if Explanations == 1</span>
<span class="c1">#   take all synonyms</span>
<span class="c1"># if Explanations &gt; 1</span>
<span class="c1">#   take synonyms by sentence: explanation.txt -&gt; synonym.sense.txt</span>

<span class="c1"># TOC</span>
<span class="c1"># Node</span>
<span class="c1">#   explanations = []   # leafs. ex: explanations = [ node, node, node ]</span>
<span class="c1">#   sections = {}       # ex: sections[ synonyms ] = [ items ]</span>

<span class="c1"># Page</span>
<span class="c1">#   toc</span>
<span class="c1">#     lang</span>
<span class="c1">#       etymology</span>
<span class="c1">#         noun              # POS</span>
<span class="c1">#           explanations    # explanations</span>
<span class="c1">#           synonyms</span>
<span class="c1">#         synonyms</span>
<span class="c1">#       synonyms</span>
<span class="c1">#</span>
<span class="c1">#   toc-node</span>
<span class="c1">#     explanations          #</span>
<span class="c1">#     parent                # -&gt; lang</span>
<span class="c1">#     childs                # []</span>
<span class="c1">#     sections              # [lang].    [synonyms, antonyms]</span>

<span class="c1"># matcher</span>
<span class="c1">#   match</span>
<span class="c1">#     explanation.txt</span>
<span class="c1">#     section / list / item.sense</span>


<span class="c1"># 1. raw-text</span>
<span class="c1"># 2. lexemes</span>
<span class="c1"># 3. Table-Of-Contents (toc)</span>
<span class="c1">#    toc-node structure:</span>
<span class="c1">#      node</span>
<span class="c1">#        title</span>
<span class="c1">#        sections</span>
<span class="c1">#        explanations</span>
<span class="c1"># 3a. load external pages:</span>
<span class="c1">#    lang</span>
<span class="c1">#      &#39;translations&#39;</span>
<span class="c1">#        section[ &#39;translations&#39; ]</span>
<span class="c1">#          trans-see|...</span>
<span class="c1">#      &#39;synonyms&#39;</span>
<span class="c1">#        section[ &#39;synonyms&#39; ]</span>
<span class="c1">#          Thesaurus:...</span>
<span class="c1"># 4. get leaf explanations only</span>
<span class="c1">#    explanations[]</span>
<span class="c1"># 5. scrap</span>
<span class="c1">#      for each leaf_explanation:</span>
<span class="c1">#        attach:</span>
<span class="c1">#          explanations &gt; 1:</span>
<span class="c1">#            5.1. attach section</span>
<span class="c1">#                find section &#39;synonyms&#39; in order: explanation / pos / etymology / lang</span>
<span class="c1">#                  get senses, cache</span>
<span class="c1">#                 .by_senses = extract_senses()</span>
<span class="c1">#                  if sections[ &#39;synonyms&#39; ] has senses:</span>
<span class="c1">#                    get by_senses</span>
<span class="c1">#                    get matches pks</span>
<span class="c1">#                    for each explanation:</span>
<span class="c1">#                      attach_section( &#39;synonyms&#39;, pks_matched_sentence )</span>
<span class="c1">#                  if sections[ &#39;synonyms&#39; ] without senses:</span>
<span class="c1">#                    attach_section( &#39;synonyms&#39; )</span>
<span class="c1">#            5.2. attach child examples</span>
<span class="c1">#            5.3. attach parent explanations</span>
<span class="c1">#                   5.3.1 attach parent explanations child examples</span>
<span class="c1">#            5.4. attach parent sections: pos / etymology / lang</span>
<span class="c1">#          explanations == 1:</span>
<span class="c1">#                find section &#39;synonyms&#39; in: explanation / pos / etymology / lang</span>
<span class="c1">#                  if sections[ &#39;synonyms&#39; ] has senses:</span>
<span class="c1">#                    attach_section( &#39;synonyms&#39; )</span>
<span class="c1">#                  if sections[ &#39;synonyms&#39; ] without senses:</span>
<span class="c1">#                    attach_section( &#39;synonyms&#39; )</span>

<span class="c1"># node</span>
<span class="c1">#   by_sense        # .by_sense[ &#39;sense text&#39; ] = [ lexem, lexem, ]</span>
<span class="c1">#   no_sense        # .no_sense = [ lexem, lexem ]</span>
<span class="c1">#</span>
<span class="c1"># extract senses in section:</span>
<span class="c1">#   synonyms      : * {{sense|...}}</span>
<span class="c1">#   translations: : {{trans-top|...}</span>
<span class="c1">#</span>
<span class="c1">#   if thesaurus:</span>
<span class="c1">#     ={{ws sense|...}}=</span>
<span class="c1">#       =synonyms=</span>
<span class="c1">#         {{ws|word}}</span>
<span class="c1">#</span>
<span class="c1"># synonyms      : Thesaurus:... -&gt;  =English= / =Noun= / ={{ws sense|...}}= / =Synonyms= / {{ws|...}}</span>
<span class="c1"># translations  : {{trans-see|...} -&gt; =English= / =Noun= / =Translations= / {{trans-top|...}</span>

<span class="c1"># find synonyms</span>
<span class="c1"># in_section</span>
<span class="c1">#   toc / lang / etymology / pos</span>
<span class="c1">#     sections          # &lt;- check title for &#39;synonyms&#39;. sections is {}</span>


<span class="c1"># translations[ sense ] = Container</span>
<span class="c1"># synonyms[ sense ] = Container</span>
<span class="c1"># hyponyms[ sense ] = Container</span>

<span class="c1"># translations[ * ] = Container</span>

<span class="c1"># parse_translations():</span>
<span class="c1">#   return translations, sense, container</span>

<span class="c1"># When &quot;Simple page&quot;:</span>
<span class="c1"># --------------------------------------------------</span>
<span class="c1"># Section( English )</span>
<span class="c1">#   Section( Noun )</span>
<span class="c1">#     Section( Translations )</span>
<span class="c1">#       senses = {</span>
<span class="c1">#           &quot;sense 1&quot;: ...,</span>
<span class="c1">#           &quot;sense 2&quot;: ...,</span>
<span class="c1">#       }</span>
<span class="c1">#</span>
<span class="c1"># When {{trans-see|sense-trans-see|label}} expanded:</span>
<span class="c1"># --------------------------------------------------</span>
<span class="c1"># Section( English )</span>
<span class="c1">#   Section( Noun )</span>
<span class="c1">#     Section( Translations )</span>
<span class="c1">#       senses = {</span>
<span class="c1">#           &quot;sense 1&quot;: ...,</span>
<span class="c1">#           &quot;sense 2&quot;: ...,</span>
<span class="c1">#           &quot;sense-trans-see&quot;: ...,  &lt;--  from &#39;catfish&#39;/English/Noun/Translations/&quot;sense-trans-see&quot;/...</span>
<span class="c1">#</span>
<span class="c1">#           &quot;type of fish&quot;: ...,  &lt;--  from &#39;catfish&#39;/English/Noun/Translations/&lt;all senses&gt;/&lt;all languages&gt;</span>
<span class="c1">#              all translations, from deep pages also</span>
<span class="c1">#           &quot;fish of the genus Silurus&quot;: ...,  &lt;---  it sense from  deep page</span>
<span class="c1">#       }</span>

</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Vital Fadeev.

    </p>
  </div>
  &copy; 2015 HPED LP | <a href="http://www8.hp.com/us/en/hpe/legal/terms-of-use.html">Terms of Use</a> | <a href="https://www.hpe.com/us/en/legal/privacy.html">Privacy</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'3.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>